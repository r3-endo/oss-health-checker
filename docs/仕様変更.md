# 仕様変更: GitHub Dashboard に npm Registry 情報を統合する

## 1. 背景（Why）

現在のダッシュボードは GitHub の開発シグナルを中心に表示しているが、
技術選定の責任を軽くするというプロダクト目的に照らすと、
「実際に使われ続けているか（Adoption）」の視点が不足している。

一方で、Registry 情報を別画面に分離すると視認性と文脈が分断され、
"Not Mapped" が多発し価値が中途半端になる問題がある。

そのため、本変更では GitHub ダッシュボード内に
**npm Registry 情報を最小限統合**する。

---

## 2. 目的（Objective）

- GitHub の Dev Health と npm Registry の Adoption 情報を同一画面で確認可能にする
- 情報過多を避け、一覧としての視認性を維持する
- スコアリングや複雑な加工は行わない
- npm 公式ページへ遷移可能にする

---

## 3. スコープ（Scope）

### 対象

- GitHub Health ダッシュボード画面

### 対象外

- Maven / PyPI / crates.io など他レジストリ
- 依存解析機能
- スコアリングロジックの変更
- 通知機能
- 課金機能

---

## 4. 表示カラム変更

### 変更前（例）

Repository | Maintainer | Stars | Open Issues | Open PRs | Last Commit

### 変更後

Repository | Maintainer | Open Issues | Last Commit | Registry

※ Stars および Open PRs は削除する。

---

## 5. Registry 列仕様

Registry 列は npm 専用とする。

### 表示状態

#### 1. npm にマッピング済みの場合

表示内容（2段表示）

npm ↗ latest: 1.2.3
published: 12d ago / 1.2M wk

表示要素:

- npm 公式ページリンク
- 最新バージョン
- 最新 publish 日
- 直近 weekly downloads
- deprecated フラグがある場合は明示表示

---

#### 2. Not Mapped の場合

N/A

#### 3. npm 対象外の場合

N/A (registry: maven)

例:

- spring-projects/spring-boot

## 6. npm から取得する情報

### 必須取得項目

- latest version
- latest publish date
- weekly downloads（last-week）
- deprecated フラグ
- package URL

### 使用API

- npm registry metadata API
- npm downloads API

## 7. データ設計変更

### 新規テーブル

packages

- id
- registry (enum: npm)
- name
- homepage_url

repository_packages

- repository_id
- package_id
- source (auto/manual)
- confidence (nullable)

package_snapshots（任意）

- package_id
- recorded_at
- weekly_downloads
- latest_version
- last_published_at

## 8. UI 要件

- Registry 列は 1 列のみ追加
- 列幅は固定せず折り返し可
- deprecated は赤色表示
- weekly downloads は簡潔表示（例: 1.2M wk）
- npm リンクは新規タブで開く
- ローディング・エラー状態を明示

---

## 9. 受け入れ基準（Acceptance Criteria）

- LLM カテゴリ内で少なくとも 2 リポジトリが npm にマッピングされる
- npm リンクが正しく遷移する
- weekly downloads が表示される
- deprecated パッケージは明示される
- GitHub Dev Health 機能に退行がない

## 10. 将来拡張

- Maven Central 対応
- PyPI 対応
- Adoption スコア導入
- Δ7d / Δ30d 表示
- 依存解析との統合

---

## 11. 設計意図

本変更は情報量を増やすことが目的ではなく、
「技術選定の責任を軽くする」ために

- 開発が回っているか（GitHub）
- 実際に使われているか（npm）

を同時に確認できる状態を作ることを目的とする。

複雑なスコアリングや正規化は行わず、
一次情報を並べる設計を維持する。
